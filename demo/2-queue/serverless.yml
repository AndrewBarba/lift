service: lift-demo-queues

provider:
    name: aws
    region: us-east-1
    lambdaHashingVersion: 20201221
    environment:
        QUEUE_URL: ${construct:import.queueUrl}
    iam:
        role:
            statements:
                # Allow to send messages to SQS
                -   Effect: Allow
                    Action: sqs:SendMessage
                    Resource: ${construct:import.queueArn}

functions:
    publisher:
        handler: publisher.handler
        runtime: nodejs14.x
        events:
            -   httpApi: 'GET /'

api:
    type: http-api
    routes:
        '*':
            handler: publisher.handler
            runtime: nodejs14.x
            environment:
                QUEUE_URL: ${construct:import.queueUrl}

import:
    type: queue
    worker:
        handler: worker.handler
    alarm: matthieu@mnapoli.fr

plugins:
    - ../../dist/src/plugin.js
